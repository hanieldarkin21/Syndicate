"""
Exponential Moving Average (EMA) - O(1) incremental
"""

from numba import njit


@njit
def calculate_ema(prev_ema, new_price, alpha):
    """
    O(1) EMA update

    Formula: EMA = alpha * price + (1 - alpha) * prev_EMA

    Args:
        prev_ema: previous EMA value
        new_price: new price
        alpha: smoothing factor (2 / (period + 1))

    Returns: new_ema
    """
    if prev_ema == 0.0:
        return new_price

    return alpha * new_price + (1.0 - alpha) * prev_ema
